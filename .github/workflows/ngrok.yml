name: AperÃ§u Flask avec ngrok

on:
  workflow_dispatch:  # Tu peux lancer manuellement ce workflow

jobs:
  preview:
    runs-on: ubuntu-latest

    steps:
    - name: Cloner le dÃ©pÃ´t
      uses: actions/checkout@v3

    - name: Installer Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.11

    - name: Installer les dÃ©pendances
      run: |
        pip install flask pyngrok

    - name: Lancer Flask + ngrok
      env:
        NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
      run: |
        echo "ðŸ”§ Lancement du serveur Flask avec ngrok..."

        # Lancer Flask en arriÃ¨re-plan
        nohup python __init__.py > flask.log 2>&1 &

        sleep 5  # Attente pour s'assurer que Flask est lancÃ©

        # GÃ©nÃ©rer le script de tunnel avec ngrok
        echo "from pyngrok import ngrok
ngrok.set_auth_token('${NGROK_AUTH_TOKEN}')
url = ngrok.connect(5000)
print('ðŸ”— Votre lien temporaire :', url)
import time
time.sleep(120)" > launch.py

        # Lancer le tunnel et attendre 2 minutes
        python launch.py
